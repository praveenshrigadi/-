<?phpsession_start();require '../../connection/connection.php';$html = array();$targetDir = "../product_image/";$targetDir1 = "../product_image_thumb/";$allowTypes = array('jpg', 'png', 'jpeg', 'gif');foreach ($_FILES['Product_IMG']['name'] as $key => $val) {    $fileName = basename($_FILES['Product_IMG']['name'][$key]);    $rename = date('mdyhms') . '-' . $fileName;    $targetFilePath = $targetDir . $rename;    $id = $_POST['id'];    $fileType = pathinfo($targetFilePath, PATHINFO_EXTENSION);    if (in_array($fileType, $allowTypes)) {        if (move_uploaded_file($_FILES["Product_IMG"]["tmp_name"][$key], $targetFilePath)) {            make_thumb($fileType, $targetFilePath, $targetDir1, 300);            $insertValuesSQL = "('" . $id . "','" . $rename . "'),";        } else {            $errorUpload .= $_FILES['Product_IMG']['name'][$key] . ' | ';        }    } else {        $errorUploadType .= $_FILES['Product_IMG']['name'][$key] . ' | ';    }		$errorUpload = !empty($errorUpload) ? 'Upload Error: ' . trim($errorUpload, ' | ') : '';$errorUploadType = !empty($errorUploadType) ? 'File Type Error: ' . trim($errorUploadType, ' | ') : '';$errorMsg = !empty($errorUpload) ? '<br/>' . $errorUpload . '<br/>' . $errorUploadType : '<br/>' . $errorUploadType;if (!empty($insertValuesSQL)) {    $insertValuesSQL = trim($insertValuesSQL, ',');    $insert = $conn->query("INSERT INTO `product_img`(`product_id`, `product_img_name`) VALUES $insertValuesSQL");    if ($insert) {        $html['error'] = 'success';        $html['msg'] = 'Insert Success';    } else {        $html['error'] = 'error';        $html['msg'] = 'Insert Failed';    }}}function make_thumb($type, $src, $dest, $desired_width) {    if (!is_dir($dest)) {        mkdir($dest, 0755, true);    }    $pInfo = pathinfo($src);    $dest = $dest . "/" . $pInfo['basename'];    if ($type === 'png') {        $source_image = imagecreatefrompng($src);    } else if ($type === 'gif') {        $source_image = imagecreatefromgif($src);    } else {        $source_image = imagecreatefromjpeg($src);    }    $width = imagesx($source_image);    $height = imagesy($source_image);    $desired_height = floor($height * ($desired_width / $width));    $virtual_image = imagecreatetruecolor($desired_width, $desired_height);    imagecopyresampled($virtual_image, $source_image, 0, 0, 0, 0, $desired_width, $desired_height, $width, $height);    imagejpeg($virtual_image, $dest);}echo json_encode($html);?>